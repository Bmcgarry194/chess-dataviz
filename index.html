<!DOCTYPE html>
<head>
<meta charset="utf-8">
<link href='http://fonts.googleapis.com/css?family=Roboto:300,400' rel='stylesheet' type='text/css'>
<link href="style.css" rel="stylesheet">
<title>Chess Tournament Grapher</title>
<script type="text/javascript">
window.heap=window.heap||[],heap.load=function(t,e){window.heap.appid=t,window.heap.config=e;var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+t+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(t){return function(){heap.push([t].concat(Array.prototype.slice.call(arguments,0)))}},p=["clearEventProperties","identify","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
heap.load("4025906112");
</script>
</head>
<body>

<div id="wrapper">
	<select id="tournament-selector">
		<option value="worldChampionship2014.json">2014 World Chess Championship</option>
		<option value="shamkir-gashimov-memorial-2015.json">2015 Shamkir Gashimov Memorial</option>
	</select>
	<select id="game-selector"></select>
	<button id="random">Random Game</button>
	<label><input type="checkbox" id="interactive-toggle" checked> Hover Guidelines</label>
</div>

<div id="wrapper" class="round"></div>

<div id="wrapper">
	<div id="player-info">
		<div class="player white">
			<div class="image"><img></div>
			<div class="name"></div>
			<div class="rating"></div>
		</div>

		<div class="result">
		</div>

		<div class="player black">
			<div class="image"><img></div>
			<div class="name"></div>
			<div class="rating"></div>
		</div>
	</div>
	<div id="graph" class="graph"></div>
</div>

<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="graph.js"></script>

<script>
	var graph = new ChessGraph('#graph', '#player-info');

	var tournament;
	var tournamentArray = [];

	function loadTournament(fileName) {
		tournamentArray = [];

		d3.json(fileName, function (error, data) {
			tournament = data;

			for( var round in tournament ) {
				var roundGames = [];

				for( var game in tournament[round][1] ) {
					var val = tournament[round][1][game];
					val.index = round + ',' + game;

					roundGames.push(val);
				}

				tournamentArray.push(roundGames);
			}

			d3.select('#game-selector').selectAll('*').remove();

			d3.select('#game-selector')
				.selectAll('optgroup').data(tournamentArray).enter()
					.append('optgroup')
						.attr('label', function (d, i) { return 'Round ' + (i + 1); })
					.selectAll('option').data(function (d) { return d; }).enter()
						.append('option')
							.attr('value', function (d, i) { return d.index; })
							.text(function (d, i) { return d.white + ' - ' + d.black; })
			;

			$('#random').click();
		});
	}

	$('#tournament-selector').on('change', function () {
		loadTournament($(this).val());
	});

	$('#tournament-selector').change();

	$('#game-selector').on('change', function () {
		var index = this.value.split(',');

		graph.update(tournament[index[0]][1][index[1]]);
	});

	$('#random').on('click', function (d, i) {
		function getRandomInt(min, max) {
			return Math.floor(Math.random() * (max - min + 1)) + min;
		}

		var round = getRandomInt(1, tournamentArray.length);
		var gameNum = getRandomInt(1, tournamentArray[0].length);
		var game = tournament[round][1][gameNum];

		graph.update(game);
		$('#game-selector').val(round + ',' + gameNum);
		$('.round').text('Round ' + round);
	});

	$('#interactive-toggle').on('change', function () {
		graph.options.interactive = $(this).is(':checked');
	});
</script>

</body>
</html>